<Window x:Class="GitDesk.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="GitDesk" Width="1400" Height="900"
        MinWidth="900" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BgDarkBrush}"
        Icon="app.ico">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar / Menu -->
        <Border Grid.Row="0" Background="{StaticResource BgMediumBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="12,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,16,0">
                    <TextBlock Text="â‘‚" FontSize="22" Foreground="{StaticResource AccentBlueBrush}"
                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="GitDesk" FontSize="16" FontWeight="Bold"
                               Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Menu Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="ðŸ“‚ Open Repo" Style="{StaticResource ModernButton}"
                            Click="OpenRepo_Click" Margin="2,0" Padding="12,6"/>
                    <Button Content="ðŸ“‹ Clone" Style="{StaticResource ModernButton}"
                            Click="CloneRepo_Click" Margin="2,0" Padding="12,6"/>
                    <Button Content="âœ¨ Init" Style="{StaticResource ModernButton}"
                            Click="InitRepo_Click" Margin="2,0" Padding="12,6"/>
                    <Rectangle Width="1" Fill="{StaticResource BorderBrush}" Margin="8,2"/>
                    <Button Content="ðŸ“ Explorer" Style="{StaticResource ModernButton}"
                            Click="OpenInExplorer_Click" Margin="2,0" Padding="12,6" ToolTip="Open in File Explorer"/>
                    <Button Content="âŒ¨ Terminal" Style="{StaticResource ModernButton}"
                            Click="OpenTerminal_Click" Margin="2,0" Padding="12,6" ToolTip="Open in Terminal"/>
                </StackPanel>

                <!-- Search -->
                <TextBox Grid.Column="2" x:Name="SearchBox" Style="{StaticResource ModernTextBox}"
                         Margin="16,0" VerticalAlignment="Center"
                         Text="" Tag="Search files, commits, branches..."
                         TextChanged="SearchBox_TextChanged"/>

                <!-- Current Repo -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="RepoNameText" Text="No repository" FontSize="13"
                               Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Branch Bar -->
        <Border Grid.Row="1" Background="{StaticResource BgMediumBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Branch selector -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,12,0">
                    <TextBlock Text="â‘‚" Foreground="{StaticResource AccentBlueBrush}" FontSize="14"
                               VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <ComboBox x:Name="BranchCombo" MinWidth="180" FontSize="13"
                              Background="{StaticResource BgLightBrush}"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              BorderBrush="{StaticResource BorderBrush}"
                              SelectionChanged="BranchCombo_SelectionChanged"/>
                </StackPanel>

                <!-- Ahead/Behind -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                    <TextBlock x:Name="AheadBehindText" Text="" FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>

                <!-- Spacer -->
                <TextBlock Grid.Column="2"/>

                <!-- Action buttons -->
                <Button Grid.Column="3" Content="â¬‡ Fetch" Style="{StaticResource ModernButton}"
                        Click="Fetch_Click" Margin="4,0" Padding="12,6"/>
                <Button Grid.Column="4" Content="â¬‡ Pull" Style="{StaticResource ModernButton}"
                        Click="Pull_Click" Margin="4,0" Padding="12,6"/>
                <Button Grid.Column="5" Content="â¬† Push" Style="{StaticResource AccentButton}"
                        Click="Push_Click" Margin="4,0" Padding="12,6"/>
                <Button Grid.Column="6" Content="ðŸ”€ Merge" Style="{StaticResource ModernButton}"
                        Click="Merge_Click" Margin="4,0" Padding="12,6"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" MinWidth="200"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar -->
            <Border Grid.Column="0" Background="{StaticResource BgMediumBrush}"
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <TabControl x:Name="SidebarTabs" Background="Transparent">
                    <TabItem Header="Changes">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Changed files list -->
                            <ListBox x:Name="ChangedFilesList" Grid.Row="0"
                                     Style="{StaticResource ModernListBox}"
                                     ItemContainerStyle="{StaticResource ModernListBoxItem}"
                                     SelectionChanged="ChangedFilesList_SelectionChanged">
                                <ListBox.ContextMenu>
                                    <ContextMenu Background="{StaticResource BgMediumBrush}"
                                                 BorderBrush="{StaticResource BorderBrush}">
                                        <MenuItem Header="Stage File" Click="StageFile_Click"
                                                  Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <MenuItem Header="Discard Changes" Click="DiscardChanges_Click"
                                                  Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <Separator/>
                                        <MenuItem Header="Blame" Click="BlameFile_Click"
                                                  Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <MenuItem Header="Open in Explorer" Click="OpenFileInExplorer_Click"
                                                  Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding StatusIcon}" Width="20" FontSize="12"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding FileName}" FontSize="13"
                                                       Foreground="{StaticResource TextPrimaryBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <!-- Commit area -->
                            <Border Grid.Row="1" Background="{StaticResource BgDarkBrush}"
                                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0"
                                    Padding="10">
                                <StackPanel>
                                    <TextBox x:Name="CommitSummary" Style="{StaticResource ModernTextBox}"
                                             Text="" Tag="Summary (required)" Margin="0,0,0,6"/>
                                    <TextBox x:Name="CommitDescription" Style="{StaticResource ModernTextBox}"
                                             Text="" Tag="Description" AcceptsReturn="True"
                                             Height="60" TextWrapping="Wrap" Margin="0,0,0,8"/>
                                    <CheckBox x:Name="AmendCheck" Content="Amend last commit"
                                              Foreground="{StaticResource TextSecondaryBrush}"
                                              FontSize="12" Margin="0,0,0,6"/>
                                    <Button x:Name="CommitButton" Content="âœ“ Commit to branch"
                                            Style="{StaticResource AccentButton}"
                                            Click="Commit_Click" HorizontalAlignment="Stretch"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </TabItem>

                    <TabItem Header="History">
                        <ListBox x:Name="HistoryList"
                                 Style="{StaticResource ModernListBox}"
                                 ItemContainerStyle="{StaticResource ModernListBoxItem}"
                                 SelectionChanged="HistoryList_SelectionChanged">
                            <ListBox.ContextMenu>
                                <ContextMenu Background="{StaticResource BgMediumBrush}"
                                             BorderBrush="{StaticResource BorderBrush}">
                                    <MenuItem Header="Cherry-pick" Click="CherryPick_Click"
                                              Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <MenuItem Header="Revert" Click="Revert_Click"
                                              Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <Separator/>
                                    <MenuItem Header="Copy SHA" Click="CopySha_Click"
                                              Foreground="{StaticResource TextPrimaryBrush}"/>
                                </ContextMenu>
                            </ListBox.ContextMenu>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,2">
                                        <TextBlock Text="{Binding MessageShort}" FontSize="13"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                            <TextBlock Text="{Binding AuthorName}" FontSize="11"
                                                       Foreground="{StaticResource AccentBlueBrush}"
                                                       Margin="0,0,8,0"/>
                                            <TextBlock Text="{Binding TimeAgo}" FontSize="11"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>

                    <TabItem Header="Branches">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Button Content="+ New Branch" Style="{StaticResource AccentButton}"
                                    Click="NewBranch_Click" Margin="8" HorizontalAlignment="Stretch"/>
                            <ListBox x:Name="BranchList" Grid.Row="1"
                                     Style="{StaticResource ModernListBox}"
                                     ItemContainerStyle="{StaticResource ModernListBoxItem}"
                                     MouseDoubleClick="BranchList_DoubleClick">
                                <ListBox.ContextMenu>
                                    <ContextMenu Background="{StaticResource BgMediumBrush}"
                                                 BorderBrush="{StaticResource BorderBrush}">
                                        <MenuItem Header="Checkout" Click="BranchCheckout_Click"
                                                  Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <MenuItem Header="Rename" Click="BranchRename_Click"
                                                  Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <MenuItem Header="Delete" Click="BranchDelete_Click"
                                                  Foreground="{StaticResource AccentRedBrush}"/>
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="â‘‚" Foreground="{StaticResource AccentBlueBrush}"
                                                       Margin="0,0,8,0" FontSize="14" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Name}" FontSize="13"
                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock Text=" â˜…" Foreground="{StaticResource AccentOrangeBrush}"
                                                       Visibility="{Binding IsHead, Converter={StaticResource BoolToVis}}"
                                                       FontSize="12" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Tags">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Button Content="+ New Tag" Style="{StaticResource AccentButton}"
                                    Click="NewTag_Click" Margin="8" HorizontalAlignment="Stretch"/>
                            <ListBox x:Name="TagList" Grid.Row="1"
                                     Style="{StaticResource ModernListBox}"
                                     ItemContainerStyle="{StaticResource ModernListBoxItem}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ·" Margin="0,0,8,0" FontSize="13" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding}" FontSize="13"
                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Remotes">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Button Content="+ Add Remote" Style="{StaticResource AccentButton}"
                                    Click="AddRemote_Click" Margin="8" HorizontalAlignment="Stretch"/>
                            <ListBox x:Name="RemoteList" Grid.Row="1"
                                     Style="{StaticResource ModernListBox}"
                                     ItemContainerStyle="{StaticResource ModernListBoxItem}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="0,2">
                                            <TextBlock Text="{Binding Name}" FontSize="13" FontWeight="SemiBold"
                                                       Foreground="{StaticResource AccentBlueBrush}"/>
                                            <TextBlock Text="{Binding Url}" FontSize="11"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Stash">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Margin="8">
                                <Button Content="ðŸ“¥ Stash All" Style="{StaticResource AccentButton}"
                                        Click="StashSave_Click" Margin="0,0,4,0"/>
                                <Button Content="ðŸ“¤ Pop" Style="{StaticResource ModernButton}"
                                        Click="StashPop_Click"/>
                            </StackPanel>
                            <ListBox x:Name="StashList" Grid.Row="1"
                                     Style="{StaticResource ModernListBox}"
                                     ItemContainerStyle="{StaticResource ModernListBoxItem}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" FontSize="13"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="3" Background="{StaticResource BorderBrush}"
                          HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- Right Content: Diff View -->
            <Border Grid.Column="2" Background="{StaticResource BgDarkBrush}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- File header -->
                    <Border Grid.Row="0" Background="{StaticResource BgMediumBrush}"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1"
                            Padding="16,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock x:Name="DiffFileHeader" Grid.Column="0" Text="Select a file to view changes"
                                       FontSize="14" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="â†© Discard" Style="{StaticResource ModernButton}"
                                        Click="DiscardChanges_Click" Padding="10,4" Margin="4,0"/>
                                <Button Content="+ Stage" Style="{StaticResource ModernButton}"
                                        Click="StageFile_Click" Padding="10,4"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Diff content -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                        <RichTextBox x:Name="DiffView" IsReadOnly="True"
                                     Background="{StaticResource BgDarkBrush}"
                                     Foreground="{StaticResource TextPrimaryBrush}"
                                     FontFamily="Cascadia Code,Consolas,Courier New"
                                     FontSize="13" BorderThickness="0" Padding="16,8"
                                     IsDocumentEnabled="True"/>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Welcome Panel (shown when no repo is open) -->
        <local:WelcomePanel x:Name="WelcomeView" Grid.Row="1" Grid.RowSpan="2"
                            xmlns:local="clr-namespace:GitDesk"
                            Visibility="Visible" Panel.ZIndex="10"/>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource BgMediumBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="StatusText" Grid.Column="0" Text="Ready"
                           FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="FileCountText" Grid.Column="1" Text=""
                           FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center" Margin="0,0,16,0"/>
                <TextBlock x:Name="BranchStatusText" Grid.Column="2" Text=""
                           FontSize="12" Foreground="{StaticResource AccentBlueBrush}"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
